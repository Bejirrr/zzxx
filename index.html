<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Obfuscator - Roblox Compatible</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .settings-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .setting-item label {
            color: #555;
            cursor: pointer;
            user-select: none;
        }

        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(102, 126, 234, 0.05);
            margin-bottom: 20px;
        }

        .drop-zone:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .drop-zone.dragover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.15);
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .drop-zone-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .obfuscate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .obfuscate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .obfuscate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            margin-bottom: 20px;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .status-log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 20px;
            display: none;
        }

        .status-log.active {
            display: block;
        }

        .status-log div {
            margin-bottom: 5px;
        }

        .download-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .download-btn.active {
            display: block;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.4);
        }

        .watermark {
            text-align: center;
            margin-top: 20px;
            color: #999;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Lua Obfuscator</h1>
            <p>Compatible with all Roblox Executors</p>
        </div>

        <div class="settings-panel">
            <div class="settings-title">‚öôÔ∏è Obfuscation Settings</div>
            <div class="setting-item">
                <input type="checkbox" id="renameVars" checked>
                <label for="renameVars">Variable Renaming (Hex Names)</label>
            </div>
            <div class="setting-item">
                <input type="checkbox" id="encryptStrings" checked>
                <label for="encryptStrings">String Encryption</label>
            </div>
            <div class="setting-item">
                <input type="checkbox" id="addJunk" checked>
                <label for="addJunk">Junk Code Insertion</label>
            </div>
            <div class="setting-item">
                <input type="checkbox" id="numberObfus" checked>
                <label for="numberObfus">Number Obfuscation</label>
            </div>
            <div class="setting-item">
                <input type="checkbox" id="controlFlow" checked>
                <label for="controlFlow">Control Flow Obfuscation</label>
            </div>
        </div>

        <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">üìÅ</div>
            <div class="drop-zone-text">Drag & Drop your .lua file here</div>
            <div style="color: #999; font-size: 0.9em;">or click to browse</div>
        </div>

        <input type="file" id="fileInput" class="file-input" accept=".lua,.txt">

        <div class="file-info" id="fileInfo">
            <div class="file-name" id="fileName"></div>
            <div class="file-size" id="fileSize"></div>
        </div>

        <button class="obfuscate-btn" id="obfuscateBtn" disabled>üöÄ Start Obfuscation</button>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-text" id="progressText">Initializing...</div>
        </div>

        <div class="status-log" id="statusLog"></div>

        <button class="download-btn" id="downloadBtn">üíæ Download Obfuscated File</button>

        <div class="watermark">
            Lua Obfuscator v3.0 | Executor Compatible
        </div>
    </div>

    <script>
        let selectedFile = null;
        let obfuscatedCode = '';
        let originalFileName = '';

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const obfuscateBtn = document.getElementById('obfuscateBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const statusLog = document.getElementById('statusLog');
        const downloadBtn = document.getElementById('downloadBtn');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.name.endsWith('.lua') && !file.name.endsWith('.txt')) {
                alert('Please select a .lua file!');
                return;
            }

            selectedFile = file;
            originalFileName = file.name;
            fileName.textContent = `üìÑ ${file.name}`;
            fileSize.textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
            fileInfo.classList.add('active');
            obfuscateBtn.disabled = false;
        }

        obfuscateBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            obfuscateBtn.disabled = true;
            progressContainer.classList.add('active');
            statusLog.classList.add('active');
            statusLog.innerHTML = '';
            downloadBtn.classList.remove('active');

            const reader = new FileReader();
            reader.onload = async (e) => {
                const code = e.target.result;
                await obfuscateLua(code);
            };
            reader.readAsText(selectedFile);
        });

        async function obfuscateLua(code) {
            const steps = [
                { progress: 15, text: 'Analyzing code structure...', delay: 300 },
                { progress: 30, text: 'Processing variables...', delay: 400 },
                { progress: 50, text: 'Encrypting strings...', delay: 500 },
                { progress: 70, text: 'Obfuscating numbers...', delay: 400 },
                { progress: 85, text: 'Adding protection layers...', delay: 500 },
                { progress: 100, text: 'Finalizing obfuscation...', delay: 300 }
            ];

            for (const step of steps) {
                await updateProgress(step.progress, step.text);
                addLog(`[${getTime()}] ${step.text}`);
                await sleep(step.delay);
            }

            const settings = {
                renameVars: document.getElementById('renameVars').checked,
                encryptStrings: document.getElementById('encryptStrings').checked,
                addJunk: document.getElementById('addJunk').checked,
                numberObfus: document.getElementById('numberObfus').checked,
                controlFlow: document.getElementById('controlFlow').checked
            };

            obfuscatedCode = performObfuscation(code, settings);

            addLog(`[${getTime()}] ‚úÖ Obfuscation completed!`);
            addLog(`[${getTime()}] Original: ${(code.length / 1024).toFixed(2)} KB`);
            addLog(`[${getTime()}] Obfuscated: ${(obfuscatedCode.length / 1024).toFixed(2)} KB`);
            addLog(`[${getTime()}] Ready for download!`);
            
            downloadBtn.classList.add('active');
            obfuscateBtn.disabled = false;
        }

        function performObfuscation(code, settings) {
            let result = code;

            // Header
            let header = `-- Obfuscated with Lua Obfuscator v3.0\n`;
            header += `-- Date: ${new Date().toLocaleString()}\n`;
            header += `-- Executor Compatible\n\n`;

            // Variable name mapping untuk konsistensi
            const varMap = new Map();
            let varCounter = 0;

            // Daftar keyword Lua yang tidak boleh diubah
            const luaKeywords = new Set([
                'and', 'break', 'do', 'else', 'elseif', 'end', 'false', 'for', 
                'function', 'if', 'in', 'local', 'nil', 'not', 'or', 'repeat', 
                'return', 'then', 'true', 'until', 'while',
                'game', 'workspace', 'script', 'wait', 'print', 'warn', 'error',
                'pairs', 'ipairs', 'next', 'pcall', 'xpcall', 'tostring', 'tonumber',
                'type', 'select', 'getfenv', 'setfenv', 'require', 'loadstring',
                'getmetatable', 'setmetatable', 'rawget', 'rawset', 'rawequal',
                'math', 'string', 'table', 'coroutine', 'os', 'debug', 'io',
                'Instance', 'Vector3', 'CFrame', 'Color3', 'UDim2', 'Enum'
            ]);

            // String encryption dengan char encoding yang kompatibel - FIXED
            if (settings.encryptStrings) {
                result = result.replace(/"([^"\\]*(\\.[^"\\]*)*)"/g, (match, str) => {
                    if (str.length === 0) return '""';
                    if (str.length > 100) return match; // Skip string panjang
                    
                    const bytes = [];
                    for (let i = 0; i < str.length; i++) {
                        bytes.push(str.charCodeAt(i));
                    }
                    
                    const varName = generateVarName();
                    const iterVar = generateVarName();
                    return `(function() local ${varName}="" for _,${iterVar} in pairs({${bytes.join(',')}}) do ${varName}=${varName}..string.char(${iterVar}) end return ${varName} end)()`;
                });

                result = result.replace(/'([^'\\]*(\\.[^'\\]*)*)'/g, (match, str) => {
                    if (str.length === 0) return "''";
                    if (str.length > 100) return match;
                    
                    const bytes = [];
                    for (let i = 0; i < str.length; i++) {
                        bytes.push(str.charCodeAt(i));
                    }
                    
                    const varName = generateVarName();
                    const iterVar = generateVarName();
                    return `(function() local ${varName}="" for _,${iterVar} in pairs({${bytes.join(',')}}) do ${varName}=${varName}..string.char(${iterVar}) end return ${varName} end)()`;
                });
            }

            // Number obfuscation
            if (settings.numberObfus) {
                result = result.replace(/\b(\d+)\b/g, (match, num) => {
                    const n = parseInt(num);
                    if (n === 0) return '(0)';
                    if (n === 1) return '(1)';
                    if (n < 10) return match;
                    
                    const a = Math.floor(Math.random() * 100) + 1;
                    const b = n - a;
                    return `(${a}+${b})`;
                });
            }

            // Variable renaming dengan pola yang aman
            if (settings.renameVars) {
                const varPattern = /\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g;
                const matches = result.match(varPattern) || [];
                
                const varCount = {};
                matches.forEach(v => {
                    if (!luaKeywords.has(v)) {
                        varCount[v] = (varCount[v] || 0) + 1;
                    }
                });

                // Hanya rename variable yang muncul lebih dari 1x
                Object.keys(varCount).forEach(varName => {
                    if (varCount[varName] > 1 && !luaKeywords.has(varName)) {
                        if (!varMap.has(varName)) {
                            varMap.set(varName, generateVarName());
                        }
                        
                        const newName = varMap.get(varName);
                        const regex = new RegExp(`\\b${escapeRegex(varName)}\\b`, 'g');
                        result = result.replace(regex, newName);
                    }
                });
            }

            // Junk code yang aman
            if (settings.addJunk) {
                const junkLines = [];
                for (let i = 0; i < 3; i++) {
                    const v1 = generateVarName();
                    const v2 = generateVarName();
                    const num = Math.floor(Math.random() * 1000);
                    junkLines.push(`local ${v1}=${num};local ${v2}=${v1}+${num}`);
                }
                result = junkLines.join(';') + '\n' + result;
            }

            // Control flow dengan do-end blocks
            if (settings.controlFlow) {
                const lines = result.split('\n');
                const protected = lines.map((line, idx) => {
                    if (idx % 5 === 0 && line.trim().length > 0 && !line.includes('function') && !line.includes('end')) {
                        return `do ${line} end`;
                    }
                    return line;
                });
                result = protected.join('\n');
            }

            return header + result;
        }

        function generateVarName() {
            const chars = 'abcdefghijklmnopqrstuvwxyz';
            const len = 8 + Math.floor(Math.random() * 4);
            let name = '_';
            for (let i = 0; i < len; i++) {
                name += chars[Math.floor(Math.random() * chars.length)];
            }
            return name;
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function getTime() {
            return new Date().toLocaleTimeString();
        }

        async function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressFill.textContent = percent + '%';
            progressText.textContent = text;
        }

        function addLog(message) {
            const logDiv = document.createElement('div');
            logDiv.textContent = message;
            statusLog.appendChild(logDiv);
            statusLog.scrollTop = statusLog.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([obfuscatedCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = originalFileName.replace('.lua', '_obfuscated.lua');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addLog(`[${getTime()}] üíæ Downloaded: ${a.download}`);
        });
    </script>
</body>
</html>
