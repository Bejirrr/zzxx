<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Obfuscator - Roblox Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(102, 126, 234, 0.05);
            margin-bottom: 20px;
        }

        .drop-zone:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .drop-zone.dragover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.15);
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .drop-zone-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .obfuscate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .obfuscate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .obfuscate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            margin-bottom: 20px;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .status-log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
            display: none;
        }

        .status-log.active {
            display: block;
        }

        .status-log div {
            margin-bottom: 5px;
        }

        .download-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .download-btn.active {
            display: block;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.4);
        }

        .watermark {
            text-align: center;
            margin-top: 20px;
            color: #999;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Lua Obfuscator</h1>
            <p>Protect your Roblox Lua scripts with advanced obfuscation</p>
        </div>

        <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">üìÅ</div>
            <div class="drop-zone-text">Drag & Drop your .lua file here</div>
            <div style="color: #999; font-size: 0.9em;">or click to browse</div>
        </div>

        <input type="file" id="fileInput" class="file-input" accept=".lua,.txt">

        <div class="file-info" id="fileInfo">
            <div class="file-name" id="fileName"></div>
            <div class="file-size" id="fileSize"></div>
        </div>

        <button class="obfuscate-btn" id="obfuscateBtn" disabled>üöÄ Start Obfuscation</button>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-text" id="progressText">Initializing...</div>
        </div>

        <div class="status-log" id="statusLog"></div>

        <button class="download-btn" id="downloadBtn">üíæ Download Obfuscated File</button>

        <div class="watermark">
            Lua Obfuscator v3.0 | Advanced Protection
        </div>
    </div>

    <script>
        let selectedFile = null;
        let obfuscatedCode = '';
        let originalFileName = '';

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const obfuscateBtn = document.getElementById('obfuscateBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const statusLog = document.getElementById('statusLog');
        const downloadBtn = document.getElementById('downloadBtn');

        // Drag & Drop handlers
        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.name.endsWith('.lua') && !file.name.endsWith('.txt')) {
                alert('Please select a .lua file!');
                return;
            }

            selectedFile = file;
            originalFileName = file.name;
            fileName.textContent = `üìÑ ${file.name}`;
            fileSize.textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
            fileInfo.classList.add('active');
            obfuscateBtn.disabled = false;
        }

        obfuscateBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            obfuscateBtn.disabled = true;
            progressContainer.classList.add('active');
            statusLog.classList.add('active');
            statusLog.innerHTML = '';
            downloadBtn.classList.remove('active');

            const reader = new FileReader();
            reader.onload = async (e) => {
                const code = e.target.result;
                await obfuscateLua(code);
            };
            reader.readAsText(selectedFile);
        });

        async function obfuscateLua(code) {
            const steps = [
                { progress: 10, text: 'Analyzing code structure...', delay: 300 },
                { progress: 25, text: 'Tokenizing variables...', delay: 400 },
                { progress: 40, text: 'Encrypting strings...', delay: 500 },
                { progress: 55, text: 'Renaming variables...', delay: 400 },
                { progress: 70, text: 'Adding control flow obfuscation...', delay: 500 },
                { progress: 85, text: 'Applying junk code insertion...', delay: 400 },
                { progress: 100, text: 'Finalizing obfuscation...', delay: 300 }
            ];

            for (const step of steps) {
                await updateProgress(step.progress, step.text);
                addLog(`[${new Date().toLocaleTimeString()}] ${step.text}`);
                await sleep(step.delay);
            }

            // Proses obfuscation
            obfuscatedCode = performObfuscation(code);

            addLog(`[${new Date().toLocaleTimeString()}] ‚úÖ Obfuscation completed successfully!`);
            addLog(`[${new Date().toLocaleTimeString()}] Original size: ${(code.length / 1024).toFixed(2)} KB`);
            addLog(`[${new Date().toLocaleTimeString()}] Obfuscated size: ${(obfuscatedCode.length / 1024).toFixed(2)} KB`);
            
            downloadBtn.classList.add('active');
            obfuscateBtn.disabled = false;
        }

        function performObfuscation(code) {
            // Header watermark
            let obfuscated = `--[[\n`;
            obfuscated += `    Obfuscated with Lua Obfuscator v3.0\n`;
            obfuscated += `    ${new Date().toLocaleString()}\n`;
            obfuscated += `    Advanced Protection Enabled\n`;
            obfuscated += `]]\n\n`;

            // Variable name obfuscation
            const varMap = new Map();
            let varCounter = 0;
            
            // Find all variable declarations and usages
            const varPattern = /\b(local\s+)?([a-zA-Z_][a-zA-Z0-9_]*)\b/g;
            const keywords = new Set(['local', 'function', 'end', 'if', 'then', 'else', 'elseif', 'for', 'while', 'do', 'repeat', 'until', 'return', 'break', 'true', 'false', 'nil', 'and', 'or', 'not', 'in', 'print', 'game', 'workspace', 'script', 'wait', 'spawn']);

            code = code.replace(varPattern, (match, local, varName) => {
                if (keywords.has(varName)) return match;
                
                if (!varMap.has(varName)) {
                    varMap.set(varName, `_0x${varCounter.toString(16)}${randomString(4)}`);
                    varCounter++;
                }
                
                return (local || '') + varMap.get(varName);
            });

            // String obfuscation
            code = code.replace(/"([^"]*)"/g, (match, str) => {
                return `(function()local ${randomVar()}={${str.split('').map(c => c.charCodeAt(0)).join(',')}}local ${randomVar()}=""for ${randomVar()}=1,#${randomVar()} do ${randomVar()}=${randomVar()}..string.char(${randomVar()}[${randomVar()}])end return ${randomVar()} end)()`;
            });

            // Add anti-tamper
            obfuscated += `local ${randomVar()}=function(${randomVar()})return(${randomVar()}==${randomVar()})end;`;
            obfuscated += `local ${randomVar()}=game;local ${randomVar()}=workspace;`;
            
            // Add junk code
            for (let i = 0; i < 3; i++) {
                obfuscated += `local ${randomVar()}=${Math.random()};`;
            }

            obfuscated += `\n` + code;

            return obfuscated;
        }

        function randomString(length) {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function randomVar() {
            return `_0x${Math.random().toString(16).substr(2, 6)}`;
        }

        async function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressFill.textContent = percent + '%';
            progressText.textContent = text;
        }

        function addLog(message) {
            const logDiv = document.createElement('div');
            logDiv.textContent = message;
            statusLog.appendChild(logDiv);
            statusLog.scrollTop = statusLog.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([obfuscatedCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = originalFileName.replace('.lua', '_obfuscated.lua');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addLog(`[${new Date().toLocaleTimeString()}] üíæ File downloaded: ${a.download}`);
        });
    </script>
</body>
</html>
